<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ═══════════════════════════════════════════════════════════════════
         Universal AI Chat Wizard - Multi-Module Support
         ═══════════════════════════════════════════════════════════════════ -->

    <!-- Form View -->
    <record id="view_ai_chat_universal_wizard_form" model="ir.ui.view">
        <field name="name">ai.chat.universal.wizard.form</field>
        <field name="model">ai.chat.universal.wizard</field>
        <field name="arch" type="xml">
            <form string="Asistente IA Universal">
                <sheet>
                    <group>
                        <group>
                            <field name="active_module" readonly="1"/>
                            <field name="selected_plugin" readonly="1"/>
                        </group>
                        <group>
                            <field name="ai_service_available" readonly="1"/>
                            <field name="allowed_plugins" readonly="1"/>
                        </group>
                    </group>

                    <group string="Contexto Activo" invisible="not context_active_model">
                        <field name="context_active_model" readonly="1"/>
                        <field name="context_active_record_name" readonly="1"/>
                    </group>

                    <notebook>
                        <page string="Conversación">
                            <group>
                                <field name="conversation_history" nolabel="1"
                                       widget="html"
                                       options="{'style-inline': true}"
                                       readonly="1"/>
                            </group>

                            <group>
                                <field name="user_message" nolabel="1"
                                       placeholder="Escribe tu pregunta o solicitud aquí..."
                                       required="1"/>
                            </group>

                            <group>
                                <field name="is_streaming_enabled"/>
                            </group>
                        </page>

                        <page string="Configuración">
                            <group string="AI Service">
                                <field name="ai_service_url" readonly="1"/>
                                <field name="session_id" readonly="1"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>

                <footer>
                    <button name="action_send_message"
                            string="Enviar"
                            type="object"
                            class="oe_highlight"
                            invisible="not ai_service_available"/>

                    <button name="action_clear_history"
                            string="Limpiar Historial"
                            type="object"
                            confirm="¿Estás seguro de reiniciar la conversación?"/>

                    <button string="Cancelar"
                            class="btn-secondary"
                            special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Action -->
    <record id="action_ai_chat_universal_wizard" model="ir.actions.act_window">
        <field name="name">Asistente IA</field>
        <field name="res_model">ai.chat.universal.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>

    <!-- Menu Item (Disabled - can be accessed via smart button or action) -->
    <!--
    <menuitem id="menu_ai_chat_universal"
              name="Asistente IA"
              parent="l10n_cl_dte.menu_dte_root"
              action="action_ai_chat_universal_wizard"
              sequence="100"
              groups="base.group_user"/>
    -->

</odoo>
