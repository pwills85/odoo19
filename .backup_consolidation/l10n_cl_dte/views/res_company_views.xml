<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         VISTA PERSONALIZADA: Formulario res.company
         Agrega campo "Raz√≥n Social Legal" visible en formulario
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <record id="view_company_form_dte" model="ir.ui.view">
        <field name="name">res.company.form.dte</field>
        <field name="model">res.company</field>
        <field name="inherit_id" ref="base.view_company_form"/>
        <field name="priority">20</field>
        <field name="arch" type="xml">

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 PASO 1: Ocultar campo del m√≥dulo oficial l10n_cl (evitar duplicaci√≥n)
                 El campo ser√° reubicado en nuestra secci√≥n organizada m√°s abajo
                 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <xpath expr="//field[@name='l10n_cl_activity_description']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 SECCI√ìN SUPERIOR: Datos del Partner (Raz√≥n Social + Ubicaci√≥n)
                 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <xpath expr="//field[@name='name']" position="after">

                <!-- Info box: Diferencia entre nombres -->
                <div class="alert alert-info mt-3 mb-3" role="alert">
                    <div class="mb-2"><strong>‚ÑπÔ∏è Diferencia entre nombres:</strong></div>
                    <ul class="mb-0 mt-2 small">
                        <li><strong>Nombre de la empresa (arriba):</strong> Nombre corto para uso interno en Odoo (ej: "EERGY GROUP SPA")</li>
                        <li><strong>Raz√≥n Social Legal (abajo):</strong> Nombre completo que aparece en facturas electr√≥nicas - DTEs</li>
                    </ul>
                </div>

                <!-- Raz√≥n Social Legal (readonly, con bot√≥n para editar partner) -->
                <label for="partner_id" string="Raz√≥n Social Legal (para DTEs)" class="fw-bold"/>
                <div class="o_row">
                    <field name="partner_id"
                           readonly="1"
                           options="{'no_open': False}"
                           context="{'show_address': 1}"/>
                    <button name="%(base.action_partner_form)d"
                            type="action"
                            string="‚úèÔ∏è Editar Ficha Completa"
                            class="btn btn-link"
                            context="{'form_view_ref': 'base.view_partner_form'}"/>
                </div>
                <div class="text-muted small mb-2">
                    Este nombre legal completo se usa en todos los documentos tributarios (XML <code>&lt;RznSoc&gt;</code>)
                </div>

                <!-- SEPARADOR -->
                <separator string="Ubicaci√≥n Tributaria (del Partner)"/>

                <!-- Ubicaci√≥n Tributaria: Regi√≥n, Comuna, Ciudad (EDITABLES) -->
                <group col="4">
                    <field name="l10n_cl_state_id"
                           string="Regi√≥n"
                           options="{'no_create': True, 'no_open': True}"
                           placeholder="Seleccione la regi√≥n..."/>

                    <field name="l10n_cl_comuna_id"
                           string="Comuna SII"
                           options="{'no_create': True, 'no_open': True}"
                           domain="[('state_id', '=', l10n_cl_state_id)]"
                           placeholder="Primero seleccione Regi√≥n, luego Comuna..."
                           context="{'default_state_id': l10n_cl_state_id}"/>

                    <field name="l10n_cl_city"
                           string="Ciudad"
                           placeholder="Ej: Santiago, Temuco, Concepci√≥n..."
                           colspan="2"/>
                </group>

                <!-- Nota explicativa -->
                <div class="alert alert-info mt-2 mb-3" role="alert">
                    <i class="fa fa-lightbulb-o" title="Informaci√≥n"/>
                    <strong>Ubicaci√≥n Tributaria:</strong> Los cambios aqu√≠ se guardan en la ficha del Partner asociado.
                    La <strong>Comuna</strong> se usa en el XML DTE como
                    <code>&lt;CmnaOrigen&gt;</code> y es <strong>OBLIGATORIA</strong>.

                    <div class="mt-2 small">
                        <strong>Flujo recomendado:</strong>
                        <ol class="mb-0 mt-1">
                            <li>Seleccione primero la <strong>Regi√≥n</strong></li>
                            <li>Luego seleccione la <strong>Comuna</strong> (se filtra autom√°ticamente por regi√≥n)</li>
                            <li>Ingrese la <strong>Ciudad</strong></li>
                        </ol>
                    </div>
                </div>

            </xpath>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 SECCI√ìN INFERIOR: Configuraci√≥n Tributaria DTE
                 Agrupa TODOS los campos tributarios necesarios para DTEs
                 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <xpath expr="//group[@name='social_media']" position="after">
                <group string="Configuraci√≥n Tributaria Chile - DTE" name="chile_tax" colspan="2">

                    <!-- GIRO: Descripci√≥n textual de la actividad (campo del m√≥dulo l10n_cl, reubicado aqu√≠) -->
                    <field name="l10n_cl_activity_description"
                           string="Giro de la Empresa"
                           placeholder="Ej: CONSULTORIAS INFORMATICAS, DESARROLLO DE SISTEMAS"
                           help="Descripci√≥n textual de la actividad econ√≥mica (m√°x 80 caracteres). Se usa en XML DTE como &lt;GiroEmis&gt; (OBLIGATORIO)"
                           colspan="2"/>

                    <!-- ACTECO: C√≥digos num√©ricos oficiales SII -->
                    <field name="l10n_cl_activity_ids"
                           widget="many2many_tags"
                           options="{'color_field': 'code', 'no_create': True}"
                           placeholder="Seleccione una o m√°s actividades econ√≥micas..."
                           colspan="2"/>

                    <!-- Info box: Diferencia entre Giro y Actividad Econ√≥mica -->
                    <div colspan="2" class="alert alert-info mt-2" role="alert">
                        <strong>‚ÑπÔ∏è Diferencia entre Giro y Actividad Econ√≥mica:</strong>
                        <table class="table table-sm table-borderless mt-2 mb-0 small">
                            <tbody>
                                <tr>
                                    <td class="fw-bold" style="width: 180px;">Giro (arriba):</td>
                                    <td>Descripci√≥n TEXTUAL libre (m√°x 80 caracteres). Aparece en facturas como <code>&lt;GiroEmis&gt;</code></td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">Actividad Econ√≥mica:</td>
                                    <td>C√≥digo(s) NUM√âRICO(S) oficial(es) SII. Aparece en facturas como <code>&lt;Acteco&gt;</code></td>
                                </tr>
                            </tbody>
                        </table>
                        <ul class="mb-0 mt-2 small">
                            <li>El <strong>Giro</strong> describe lo que hace tu empresa en lenguaje simple</li>
                            <li>Las <strong>Actividades Econ√≥micas</strong> son c√≥digos oficiales del clasificador CIIU Rev. 4 CL</li>
                            <li>Una empresa puede tener <strong>m√∫ltiples</strong> actividades econ√≥micas (hasta 4 en DTEs)</li>
                            <li>Ambos campos son <strong>OBLIGATORIOS</strong> para emisi√≥n de DTEs</li>
                            <li>
                                <a href="https://www.sii.cl/destacados/codigos_actividades/" target="_blank">
                                    üìã Ver cat√°logo oficial de c√≥digos SII
                                </a>
                            </li>
                        </ul>
                    </div>
                </group>
            </xpath>

        </field>
    </record>

</odoo>
