<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         DTE CONTINGENCY STATUS VIEWS - Native Implementation
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         Migration from: odoo-eergy-services/contingency/contingency_manager.py (2025-10-24)

         OBLIGATORIO por normativa SII chilena.
    -->

    <!-- Tree View -->
    <record id="view_dte_contingency_tree" model="ir.ui.view">
        <field name="name">dte.contingency.tree</field>
        <field name="model">dte.contingency</field>
        <field name="arch" type="xml">
            <list string="Contingency Mode Status" create="false" decoration-danger="enabled == True" decoration-success="enabled == False">
                <field name="company_id" groups="base.group_multi_company"/>
                <field name="enabled" widget="boolean_toggle"/>
                <field name="reason" string="Reason"/>
                <field name="enabled_date" string="Enabled Since"/>
                <field name="pending_dtes_count" string="Pending DTEs"/>
                <field name="enabled_by" string="Enabled By"/>
            </list>
        </field>
    </record>

    <!-- Form View -->
    <record id="view_dte_contingency_form" model="ir.ui.view">
        <field name="name">dte.contingency.form</field>
        <field name="model">dte.contingency</field>
        <field name="arch" type="xml">
            <form string="Contingency Mode Status" create="false">
                <header>
                    <div class="alert alert-danger" role="alert" invisible="enabled == False">
                        <strong>ðŸ”´ CONTINGENCY MODE ACTIVE</strong>
                        <p>DTEs are being stored locally until SII is available again.</p>
                    </div>

                    <div class="alert alert-success" role="alert" invisible="enabled == True">
                        <strong>âœ… Normal Operation</strong>
                        <p>DTEs are being sent directly to SII.</p>
                    </div>
                </header>

                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_pending_dtes"
                                type="object"
                                class="oe_stat_button"
                                icon="fa-clock-o"
                                invisible="pending_dtes_count == 0">
                            <field name="pending_dtes_count" widget="statinfo" string="Pending DTEs"/>
                        </button>
                    </div>

                    <div class="oe_title">
                        <h1>
                            <field name="company_id" readonly="1" groups="base.group_multi_company"/>
                        </h1>
                        <h2>
                            <span invisible="enabled == False">ðŸ”´ Contingency Mode Active</span>
                            <span invisible="enabled == True">âœ… Normal Operation</span>
                        </h2>
                    </div>

                    <group>
                        <group name="status_info" string="Status Information">
                            <field name="enabled" widget="boolean_toggle" readonly="1"/>
                            <field name="reason" readonly="1" invisible="reason == False"/>
                            <field name="comment" readonly="1" invisible="comment == False"/>
                        </group>

                        <group name="statistics" string="Statistics">
                            <field name="pending_dtes_count" readonly="1"/>
                        </group>
                    </group>

                    <notebook>
                        <page name="history" string="History">
                            <group>
                                <group name="enabled_info" string="Last Enabled">
                                    <field name="enabled_date" readonly="1"/>
                                    <field name="enabled_by" readonly="1"/>
                                </group>

                                <group name="disabled_info" string="Last Disabled">
                                    <field name="disabled_date" readonly="1"/>
                                    <field name="disabled_by" readonly="1"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Search View -->
    <record id="view_dte_contingency_search" model="ir.ui.view">
        <field name="name">dte.contingency.search</field>
        <field name="model">dte.contingency</field>
        <field name="arch" type="xml">
            <search string="Contingency Mode Status">
                <field name="company_id" groups="base.group_multi_company"/>

                <filter name="filter_enabled" string="Active Contingency" domain="[('enabled', '=', True)]"/>
                <filter name="filter_disabled" string="Disabled" domain="[('enabled', '=', False)]"/>
                <!-- filter_with_pending removed: pending_dtes_count is computed non-stored field -->

                <separator/>

                <filter name="filter_manual" string="Manual Activation" domain="[('reason', '=', 'manual')]"/>
                <filter name="filter_sii_unavailable" string="SII Unavailable" domain="[('reason', '=', 'sii_unavailable')]"/>
                <filter name="filter_circuit_breaker" string="Circuit Breaker" domain="[('reason', '=', 'circuit_breaker')]"/>
                <filter name="filter_timeout" string="Timeout Threshold" domain="[('reason', '=', 'timeout_threshold')]"/>

                <separator/>

                <group>
                    <filter name="group_company" string="Company" context="{'group_by': 'company_id'}"/>
                    <filter name="group_enabled" string="Status" context="{'group_by': 'enabled'}"/>
                    <filter name="group_reason" string="Reason" context="{'group_by': 'reason'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Action -->
    <record id="action_dte_contingency" model="ir.actions.act_window">
        <field name="name">Contingency Mode Status</field>
        <field name="res_model">dte.contingency</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_filter_enabled': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Contingency Mode Status
            </p>
            <p>
                Monitor and manage contingency mode status for each company.
                Contingency mode is OBLIGATORIO by SII regulations and allows
                operations when SII is unavailable.
            </p>
        </field>
    </record>

    <!-- Menu Item: MOVED to views/menus.xml to fix loading order issue -->
</odoo>
