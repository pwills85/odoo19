id,severidad,componente,archivo_linea,descripcion,impacto,recomendacion,esfuerzo_h,sprint_sugerido,estado
FR-001,P0,Arquitectura/Servicios,addons/localization/l10n_cl_financial_reports/models/__init__.py:5-49,"El paquete models no importa los submódulos core ni services, por lo que modelos críticos como financial.report.service.registry, dashboard.export.service y account.financial.report.sii.integration.service nunca se registran.","Todos los llamados a self.env['financial.report.service.*'] y hooks fallan con KeyError, dejando sin backend a dashboards, integraciones SII y registros post-init.","Cargar explícitamente from . import core y from . import services, añadir tests de smoke que verifiquen la existencia de los modelos antes de ejecutar hooks.",6,Sprint 0,pendiente
FR-002,P0,F29 UI/Modelo,addons/localization/l10n_cl_financial_reports/views/l10n_cl_f29_views.xml:12-118,"La vista de formulario F29 usa campos (period_string, ventas_gravadas, compras_total, move_ids, folio, sii_track_id) y botones (action_send_sii/action_check_status/action_replace) que no existen en models/l10n_cl_f29.py.","La vista no puede cargar (MissingError) ni ejecutar botones, imposibilitando cualquier operación sobre el formulario F29.","Agregar los campos y métodos declarados en la vista o depurar la vista para que sólo use atributos implementados; incluir tests de view-loading.",16,Sprint 0,pendiente
FR-003,P0,F29 Cálculos,addons/localization/l10n_cl_financial_reports/models/l10n_cl_f29.py:112-157,"action_calculate usa period_date.replace (string) provocando TypeError y además nunca acumula total_ventas/total_compras, limitándose al IVA de las líneas.","El cálculo falla antes de iniciarse y aunque corriera siempre deja totales en cero, incumpliendo F29 y cualquier control tributario.","Normalizar period_date con fields.Date.to_date, calcular bases por tax tags (ventas/compras afectas/exentas) e incorporar NC/ND, multi-compañía y retenciones.",20,Sprint 0,pendiente
FR-004,P0,F29 account.report,addons/localization/l10n_cl_financial_reports/data/account_report_f29_cl_data.xml:23-194,"El XML incrusta <record> de lineas dentro de <field name="line_ids"> y usa fórmulas F29_20/F29_520 que no están definidas en tax tags.","La importación falla con ValueError y el reporte F29 no existe en Odoo, por lo que no hay evidencia de cumplimiento ante SII.","Reescribir el data file usando comandos (0,0,values) o registros separados y crear los tax tags/códigos correspondientes.",18,Sprint 0,pendiente
FR-005,P0,SII Integration,addons/localization/l10n_cl_financial_reports/models/l10n_cl_f22.py:437-478,"action_calculate F22 invoca self.env['account.financial.report.sii.integration.service'], pero el modelo nunca se carga porque services/ no se importa.","El cálculo real de F22 revienta con KeyError y no hay integración SII operativa, incumpliendo normativa anual.","Tras habilitar imports del paquete services, agregar tests que garanticen disponibilidad del modelo y cubrir send_f22/send_f29 con mocks contra el SII.",8,Sprint 0,pendiente
FR-006,P0,Automatización,addons/localization/l10n_cl_financial_reports/data/l10n_cl_tax_forms_cron.xml:5-75,"Se crean manualmente registros ir.model duplicados y se agenda un cron que llama create_monthly_f29(), método inexistente en l10n_cl.f29.","La actualización del módulo rompe (record already exists) y el cron falla en cada ejecución, dejando trazas de error recurrentes.","Eliminar la creación manual de ir.model, implementar create_monthly_f29 con políticas multicompañía o retirar el cron hasta tener lógica real.",10,Sprint 0,pendiente
FR-007,P1,HTTP/API,addons/localization/l10n_cl_financial_reports/controllers/__init__.py:2-7,"Sólo se importan main, dashboard_export_controller y universal_api; controladores declarados para analítica, ratio analysis y WebSocket no se cargan.","Endpoints documentados (REST/OWL widgets) no existen y cualquier cliente que los invoque recibe 404, rompiendo la promesa de integración máxima.","Registrar todos los controladores en __init__, cubrirlos con pruebas http -at_install y documentar los disponibles.",6,Sprint 0,pendiente
FR-008,P1,HTTP/API,addons/localization/l10n_cl_financial_reports/controllers/main.py:1-41,"FinancialReportController usa _logger sin definir y depende de un modelo financial.report.service inexistente (ver FR-001).",La ruta /financial_reports/get_report_data retorna 500 incluso antes de ejecutar negocio.,"Importar logging/_logger, usar modelos reales o eliminar la ruta hasta que exista el servicio y agregar pruebas json-controller.",5,Sprint 0,pendiente
FR-009,P1,Realtime Dashboard,addons/localization/l10n_cl_financial_reports/static/src/services/dashboard_websocket_service.js:1-120,"El frontend abre ws://.../websocket/dashboard, pero el controlador está comentado en controllers/__init__.py y además usa type='websocket', no soportado en Odoo 19.","Los widgets OWL quedan bloqueados esperando WebSocket; la actualización en tiempo real nunca ocurre y genera errores en consola.","Reemplazar por bus.longpolling (mail.bus) o eliminar la dependencia WebSocket, activando el controlador como JSON route sólo si se demuestra soporte.",20,Sprint 1,pendiente
FR-010,P1,Seguridad Multi-compañía,addons/localization/l10n_cl_financial_reports/models/financial_dashboard_widget.py:12-85,"financial.dashboard.widget carece de company_id y record rules; cualquier usuario con base.group_user accede a KPIs de otras compañías.","Datos financieros consolidados se filtran entre compañías en entornos multi-company, violando políticas Enterprise.","Agregar campo company_id, heredar company.security.mixin o record rules por compañía y ajustar ACLs/grupos.",12,Sprint 1,pendiente
FR-011,P1,Dashboards,addons/localization/l10n_cl_financial_reports/models/financial_dashboard_layout.py:63-80,"get_layout_for_user usa la variable 'layout' sin definir antes de llamar with_context, provocando NameError al cargar dashboards.","El dashboard principal no se puede abrir: la llamada RPC falla cada vez que intenta leer layouts.","Corregir el uso de self.with_context, añadir tests de layouts y garantizar caching opcional real (actualmente no se usa).",4,Sprint 0,pendiente
FR-012,P1,Infraestructura Cache,addons/localization/l10n_cl_financial_reports/models/services/cache_service.py:127-155,"CacheService es una clase libre que en warm_cache refiere self.env, atributo inexistente fuera de modelos Odoo.","Cualquier intento de precalentar cache termina en AttributeError, por lo que el supuesto performance layer es inoperante.","Convertir CacheService en models.AbstractModel o inyectar env al inicializar, y usar redis opcional vía ir.config_parameter.",10,Sprint 1,pendiente
FR-013,P2,F22 UI,addons/localization/l10n_cl_financial_reports/views/l10n_cl_f22_views.xml:1-5,"El archivo de vistas F22 es un placeholder vacío, aun cuando el manifiesto declara formularios completos.","Usuarios no pueden revisar ni aprobar Formularios 22 dentro de la interfaz, incumpliendo objetivo funcional/normativo.","Construir vistas form/tree/search reales con botones alineados a los métodos disponibles y validarlos con tests de carga de vistas.",24,Sprint 1,pendiente
FR-014,P2,Exportes,addons/localization/l10n_cl_financial_reports/models/financial_report_service_model.py:348-353,"export_to_pdf devuelve un ir.actions.report apuntando a 'l10n_cl_financial_reports.financial_report_pdf', plantilla que no existe en /report ni /views.","Cualquier exportación PDF lanza QWebError y no hay evidencia descargable para auditorías.","Crear el template QWeb + paperformat o reemplazar el action por report_xlsx/report_py ya disponibles.",6,Sprint 1,pendiente
FR-015,P1,CI/CD,.github/workflows/quality-gates.yml:35-95,"Todos los workflows CI apuntan exclusivamente a addons/localization/l10n_cl_dte; el módulo financiero no tiene lint/tests en pipelines.","Regresiones del módulo pasan desapercibidas; no hay gate automático que detecte errores de instalación o vistas.","Duplicar los jobs existentes para apuntar a l10n_cl_financial_reports y añadir smoke test (odoo-bin -i módulo).",8,Sprint 2,pendiente
FR-016,P2,Testing,addons/localization/l10n_cl_financial_reports/tests/test_performance.py:20-80,"El test de performance crea 100k asientos dentro del suite estándar, lo que hace impracticable ejecutar tests en CI/local.","El paquete de pruebas se vuelve inutilizable, nadie puede ejecutar 'odoo-bin -t' sin agotar recursos.","Mover el benchmark a tools/manual, parametrizar el volumen mediante env vars y dejar tests automatizados realistas (dataset pequeño).",6,Sprint 2,pendiente
