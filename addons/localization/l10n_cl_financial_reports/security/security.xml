<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        
        <!-- ========================================== -->
        <!-- GRUPOS DE SEGURIDAD FINANCIAL REPORTS     -->
        <!-- ========================================== -->
        
        <!-- Grupo: Usuario de Reportes Financieros -->
        <record id="group_financial_reports_user" model="res.groups">
            <field name="name">Financial Reports: User</field>
            <field name="category_id" ref="base.module_category_accounting"/>
            <field name="comment">Puede ver y generar reportes financieros básicos</field>
        </record>
        
        <!-- Grupo: Manager de Reportes Financieros -->
        <record id="group_financial_reports_manager" model="res.groups">
            <field name="name">Financial Reports: Manager</field>
            <field name="category_id" ref="base.module_category_accounting"/>
            <field name="implied_ids" eval="[(4, ref('group_financial_reports_user'))]"/>
            <field name="comment">Puede configurar y administrar todos los reportes financieros</field>
        </record>
        
        <!-- Grupo: Analista Financiero -->
        <record id="group_financial_analyst" model="res.groups">
            <field name="name">Financial Reports: Analyst</field>
            <field name="category_id" ref="base.module_category_accounting"/>
            <field name="implied_ids" eval="[(4, ref('group_financial_reports_user'))]"/>
            <field name="comment">Puede acceder a análisis avanzados y dashboards ejecutivos</field>
        </record>
        
        <!-- ========================================== -->
        <!-- REGLAS DE ACCESO A REGISTROS              -->
        <!-- ========================================== -->
        
        <!-- Regla: Acceso a reportes por compañía -->
        <record id="financial_report_company_rule" model="ir.rule">
            <field name="name">Financial Reports: Company Rule</field>
            <field name="model_id" ref="model_account_financial_report_service"/>
            <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
            <field name="groups" eval="[(4, ref('group_financial_reports_user'))]"/>
        </record>
        
        <!-- Regla: Dashboards por usuario -->
        <record id="financial_dashboard_user_rule" model="ir.rule">
            <field name="name">Financial Dashboard: User Rule</field>
            <field name="model_id" ref="model_financial_dashboard_layout"/>
            <field name="domain_force">[('user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_financial_reports_user'))]"/>
        </record>
        
        <!-- Regla: Managers pueden ver todos los dashboards -->
        <record id="financial_dashboard_manager_rule" model="ir.rule">
            <field name="name">Financial Dashboard: Manager Rule</field>
            <field name="model_id" ref="model_financial_dashboard_layout"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_financial_reports_manager'))]"/>
        </record>
        
        <!-- ========================================== -->
        <!-- ASIGNACIÓN DE GRUPOS A USUARIOS BASE      -->
        <!-- ========================================== -->
        
        <!-- Contadores tienen acceso como usuarios -->
        <record id="account.group_account_user" model="res.groups">
            <field name="implied_ids" eval="[(4, ref('group_financial_reports_user'))]"/>
        </record>
        
        <!-- Managers de contabilidad son managers de reportes -->
        <record id="account.group_account_manager" model="res.groups">
            <field name="implied_ids" eval="[(4, ref('group_financial_reports_manager'))]"/>
        </record>
        
    </data>
</odoo>
