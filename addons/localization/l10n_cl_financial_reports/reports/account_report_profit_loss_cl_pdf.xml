<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Report Definition for PDF Export -->
    <record id="action_report_profit_loss_cl_pdf" model="ir.actions.report">
        <field name="name">Estado de Resultados (Chile) - PDF</field>
        <field name="model">account.report</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">l10n_cl_financial_reports.report_profit_loss_cl_document</field>
        <field name="report_file">l10n_cl_financial_reports.report_profit_loss_cl_document</field>
        <field name="print_report_name">'Estado_Resultados_CL_%s' % (time.strftime('%Y_%m_%d'))</field>
    </record>

    <!-- QWeb Template for PDF -->
    <template id="report_profit_loss_cl_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                    <div class="page">
                        <!-- Header -->
                        <div class="row mb-4">
                            <div class="col-12 text-center">
                                <h2>ESTADO DE RESULTADOS</h2>
                                <h3>ESTADO DE RESULTADOS INTEGRALES</h3>
                                <h4><span t-field="o.company_id.name"/></h4>
                            </div>
                        </div>

                        <!-- Period Info -->
                        <div class="row mb-4">
                            <div class="col-12 text-center">
                                <p class="mb-0">
                                    <strong>Período:</strong>
                                    Del <span t-esc="context.get('date_from', 'N/A')"/>
                                    al <span t-esc="context.get('date_to', 'N/A')"/>
                                </p>
                                <p class="text-muted small mb-0">
                                    (Expresado en Pesos Chilenos - CLP)
                                </p>
                            </div>
                        </div>

                        <hr/>

                        <!-- Income Statement Content -->
                        <div class="mb-4">
                            <table class="table table-sm table-bordered">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width: 70%;">Concepto</th>
                                        <th style="width: 30%;" class="text-end">Monto (CLP)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Ingresos Operacionales -->
                                    <tr class="table-info">
                                        <td class="fw-bold">INGRESOS DE ACTIVIDADES ORDINARIAS</td>
                                        <td class="text-end fw-bold">
                                            <!-- Placeholder - populated by account.report -->
                                        </td>
                                    </tr>

                                    <!-- Costo de Ventas -->
                                    <tr>
                                        <td class="ps-4">Costo de Ventas</td>
                                        <td class="text-end">
                                            <!-- Placeholder - populated by account.report -->
                                        </td>
                                    </tr>

                                    <!-- Utilidad Bruta -->
                                    <tr class="table-success">
                                        <td class="fw-bold">UTILIDAD (PÉRDIDA) BRUTA</td>
                                        <td class="text-end fw-bold">
                                            <!-- Placeholder - populated by account.report -->
                                        </td>
                                    </tr>

                                    <!-- Otros Ingresos -->
                                    <tr>
                                        <td class="ps-4">Otros Ingresos</td>
                                        <td class="text-end">
                                            <!-- Placeholder - populated by account.report -->
                                        </td>
                                    </tr>

                                    <!-- Gastos de Administración y Ventas -->
                                    <tr>
                                        <td class="ps-4">Gastos de Administración y Ventas</td>
                                        <td class="text-end">
                                            <!-- Placeholder - populated by account.report -->
                                        </td>
                                    </tr>

                                    <!-- Utilidad Operacional -->
                                    <tr class="table-warning">
                                        <td class="fw-bold">UTILIDAD (PÉRDIDA) OPERACIONAL</td>
                                        <td class="text-end fw-bold">
                                            <!-- Placeholder - calculated aggregate -->
                                        </td>
                                    </tr>

                                    <!-- Utilidad Neta -->
                                    <tr class="table-primary">
                                        <td class="fw-bold">UTILIDAD (PÉRDIDA) DEL EJERCICIO</td>
                                        <td class="text-end fw-bold">
                                            <!-- Placeholder - populated by account.report -->
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Key Ratios Section (Optional) -->
                        <div class="mb-4">
                            <h5 class="bg-light p-2">Indicadores Clave</h5>
                            <table class="table table-sm">
                                <tbody>
                                    <tr>
                                        <td style="width: 70%;">Margen Bruto (%)</td>
                                        <td style="width: 30%;" class="text-end">
                                            <!-- (Utilidad Bruta / Ingresos) * 100 -->
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Margen Operacional (%)</td>
                                        <td class="text-end">
                                            <!-- (Utilidad Operacional / Ingresos) * 100 -->
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Margen Neto (%)</td>
                                        <td class="text-end">
                                            <!-- (Utilidad Neta / Ingresos) * 100 -->
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Footer Notes -->
                        <div class="mt-5">
                            <p class="text-muted small">
                                <strong>Nota:</strong> Este Estado de Resultados presenta el desempeño financiero
                                de la empresa durante el período indicado, mostrando los ingresos, costos y gastos
                                conforme a las Normas Internacionales de Información Financiera (NIIF) y las
                                prácticas contables chilenas.
                            </p>
                            <p class="text-muted small">
                                Generado el: <span t-esc="datetime.datetime.now().strftime('%d/%m/%Y %H:%M')"/> |
                                Sistema: Odoo 19 CE - l10n_cl_financial_reports
                            </p>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

</odoo>
