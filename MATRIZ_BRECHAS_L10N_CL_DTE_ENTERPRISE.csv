ID,Severidad,Componente,Descripción,Evidencia,Impacto,Causa Raíz,Recomendación,Esfuerzo (h),Owner,Sprint,Estado,Criterio Aceptación
B-001,P0,Rate Limiting,Rate limiting en memoria (no persistente),controllers/dte_webhook.py:26,Multi-worker pierde state; reinicio borra contadores,In-memory dict sin backend persistente,Migrar a Redis con expiry keys y rate limit distribuido,4,DevOps,Sprint 0,ABIERTO,"Prueba: 100 requests en 60s desde 2 IPs distribuidas; validar bloqueo correcto sin falsos positivos"
B-002,P0,Webhooks,Falta validación timestamp/replay attack,controllers/dte_webhook.py:178-198,Replay attacks posibles; mensajes viejos aceptados,HMAC sin timestamp ni nonce en payload,Añadir timestamp + nonce; validar ventana 5 min; rechazar duplicados con Redis,6,Backend,Sprint 0,ABIERTO,"Prueba: enviar mismo payload 2x; segundo debe fallar 401. Enviar mensaje >5min antiguo; debe fallar 401"
B-003,P0,Webhooks,Secret key con default inseguro,controllers/dte_webhook.py:180-182,Atacante puede forjar firmas si no cambian default,Default hardcoded sin rotación,Generar key aleatoria en install; documentar rotación; env var,2,Backend,Sprint 0,ABIERTO,Validar que default_webhook_key_change_in_production NO existe en producción; key >= 32 bytes random
B-004,P0,XSD,Solo smoke test DTE 52; faltan 33/34/56/61,tests/smoke/,DTEs 33/34/56/61 pueden fallar XSD sin detectar,Solo 2 fixtures DTE 52,Crear smoke tests para 33/34/56/61 (con/sin refs; descuentos; recargos),8,QA,Sprint 0,ABIERTO,"5 scripts ejecutables: smoke_xsd_dte{33,34,52,56,61}.py; todos PASS"
B-005,P1,DTE 52,Falta variante sin valorización (PrcItem=0),tests/fixtures/,DTE 52 guías sin valorización pueden fallar XSD,Solo fixtures con precios; schema permite PrcItem opcional,Añadir fixture DTE 52 sin PrcItem + smoke test,4,QA,Sprint 1,ABIERTO,Smoke test PASS para dte52_no_price.xml validado contra DTE_v10.xsd
B-006,P1,SII Códigos,Solo 5 códigos mapeados vs 59+ oficiales,libs/sii_soap_client.py:497-502,Usuarios no reciben mensajes claros en rechazos SII,Mapeo incompleto de glosas SII,Expandir dict con 59 códigos SII (ENV-3-0; DTE-3-101; TED-2-510; etc),4,Backend,Sprint 1,ABIERTO,Dict con >=50 códigos SII; test unitario para 10 códigos críticos
B-007,P1,Namespace XML,Generadores DTE sin xmlns SII,libs/xml_generator.py:110+,Rechazo XSD estricto; problemas interoperabilidad,Elemento raíz sin nsmap,Añadir nsmap={'': 'http://www.sii.cl/SiiDte'} en 5 generadores,2,Backend,Sprint 1,ABIERTO,XSD PASS para DTEs generados; validar xmlns en XML output
B-008,P1,Validación RUT,Implementación custom duplicada,libs/dte_structure_validator.py:96-137,Riesgo bugs en edge cases (RUT 100; verificador K),Código custom en lugar de python-stdnum,Eliminar custom; centralizar en python-stdnum.cl.rut,3,Backend,Sprint 1,ABIERTO,"Tests: RUT 100, 76.XXX.XXX-K; validar con stdnum; sin custom code"
B-009,P1,Idempotencia,Falta validación duplicados track_id,models/account_move_dte.py,Reintentos pueden duplicar DTEs en SII,No check de track_id previo,Unique constraint track_id + validación antes de envío,3,Backend,Sprint 1,ABIERTO,"Prueba: enviar mismo DTE 2x; segundo debe detectar duplicado y skip envío"
B-010,P1,ACLs,16 modelos sin ACLs definidas,security/ir.model.access.csv,Usuarios pueden acceder sin autorización; violación RBAC,Modelos custom sin entradas ACL,Añadir 16 entradas desde MISSING_ACLS_TO_ADD.csv,2,Backend,Sprint 1,ABIERTO,Validación: python3 scripts/validate_odoo19_standards.py con 0 warnings ACL
B-011,P2,Referencias NC/ND,Validación solo warning (no constraint),models/account_move_enhanced.py:401,NC/ND sin referencia enviados a SII; rechazo REF-3-415,Warning en lugar de ValidationError,Cambiar a @api.constrains con raise ValidationError,1,Backend,Sprint 2,ABIERTO,"Test: crear NC sin referencia; debe fallar con ValidationError antes de post"
B-012,P2,Campos Obligatorios,Validación incompleta vs schema SII,libs/dte_structure_validator.py:154-161,DTEs pueden fallar con ENV-3-0 (schema),Solo 6 campos validados de 20+ obligatorios,Expandir required_fields por tipo DTE con schema completo,4,Backend,Sprint 2,ABIERTO,Validación contra 20 campos obligatorios; test con XML mínimo
B-013,P2,CAF Vencimiento,No valida límite 18 meses SII,libs/caf_handler.py:367-390,CAF vencidos usados localmente; rechazo CAF-3-517,Validación genérica >2 años; SII requiere 18 meses,Implementar check 540 días + warning 30 días antes,2,Backend,Sprint 2,ABIERTO,"Test: CAF con fecha >18 meses; debe fallar. CAF con 17.5 meses; warning"
B-014,P2,Tasa IVA,Hardcoded 0.19 sin parametrización,libs/dte_structure_validator.py:48,Cambio IVA requiere modificación código,Magic number sin config,Migrar a ir.config_parameter con histórico de tasas,2,Backend,Sprint 2,ABIERTO,Config param l10n_cl_dte.iva_rate usado; sin hardcode 0.19
B-015,P2,SOAP Timeout,Timeout configurado pero sin connect/read split,libs/sii_soap_client.py:161,Timeout aplica total; no diferencia connect vs read,Transport(timeout=N) es timeout total,Implementar session.timeout = (30 connect, 120 read),1,Backend,Sprint 2,ABIERTO,Código con session.timeout=(30 120); logs muestran timeout split
B-016,P2,Logging,No estructurado para análisis automático,libs/sii_soap_client.py:270-287,Dificulta alertas y métricas de rechazos SII,Logs en formato string sin extra fields,Migrar a structlog o logger.error(...  extra={...}),3,Backend,Sprint 2,ABIERTO,"Logs con campos estructurados (dte_type, folio, error_code); parseable por ELK"
B-017,P3,Tests XSD,Cobertura 1/5 tipos (solo DTE 52),tests/smoke/,Bajo coverage smoke tests,Priorización DTE 52 únicamente,Añadir smoke tests para 33/34/56/61,4,QA,Sprint 3,ABIERTO,5 smoke tests ejecutables; todos con fixtures +/-variantes
B-018,P3,Performance,Sin tests p95 < 500ms objetivo,tests/,No validación latencias mencionadas en spec,Falta suite performance,Crear performance_tests/ con locust o pytest-benchmark,6,QA,Sprint 3,ABIERTO,"Ejecutar 1000 DTE/h; p95 <500ms; p99 <1s; sin memory leaks"
B-019,P3,CI/CD,No existe pipeline automatizado,.,Cambios sin validación automática antes de merge,Falta configuración CI,Crear .github/workflows/ci.yml con lint/tests/coverage gates,8,DevOps,Sprint 3,ABIERTO,PR bloqueado si coverage <80% o lint fail; smoke XSD en pipeline
B-020,P3,Magic Numbers,Tolerancia redondeo sin explicación,libs/dte_structure_validator.py:240+,Código poco mantenible; magic numbers,Valores hardcoded sin constantes,Extraer a constantes con docstring explicando fuente SII,1,Backend,Sprint 3,ABIERTO,Sin magic numbers; constantes con comentarios normativos
B-021,P3,Documentación,Falta docstring algoritmo TED,libs/ted_generator.py:148-197,Dificulta onboarding y auditorías,Método crítico sin docs,Añadir docstring con Resolución SII 40/2006 + pasos algoritmo,1,Backend,Sprint 3,ABIERTO,Docstring >=10 líneas con refs normativas y pasos
B-022,P3,Validación RUT,Falta validación caracteres inválidos,libs/dte_structure_validator.py:110,RUT con caracteres raros pasan validación,Solo limpia . y -; no valida formato,Añadir regex ^\d{7 9}[0-9K]$ antes de validar módulo 11,1,Backend,Sprint 3,ABIERTO,"Test: RUT 'abc-1' debe fallar; '12.345.678-9' debe PASS"
B-023,P3,Tests Metadata,Tests sin documentar normativa,tests/test_*.py,Dificulta entender qué valida cada test,Falta docstring en TestCase classes,Añadir docstring con refs (Res. 11/2003; Circular 28/2008),2,QA,Sprint 3,ABIERTO,>=50% test classes con docstring normativa
B-024,P0,Odoo Estándares,Duplicación _name + _inherit,models/account_move_dte.py:51-52,Conflictos herencia; comportamiento impredecible,Código legacy migrado incorrectamente,Eliminar línea 51 (_name); mantener solo _inherit,0.05,Backend,Sprint 0,ABIERTO,Validación: sin _name='account.move' en account_move_dte.py:51
B-025,P2,Códigos Actividad,No valida contra catálogo SII,models/sii_activity_code.py,DTE con código no autorizado; rechazo HED-*,Falta validación CIIU Rev. 4 CL,Añadir constraint validando 6 dígitos + catálogo oficial,3,Backend,Sprint 2,ABIERTO,Constraint rechaza código 999999; acepta códigos válidos oficiales
