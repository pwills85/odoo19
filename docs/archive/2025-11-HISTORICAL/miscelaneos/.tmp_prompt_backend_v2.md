# CONTEXTO

Lee PRIMERO este archivo para entender tu rol y permisos:
`/Users/pedro/Documents/odoo19/docs/prompts/00_knowledge_base/CLI_AGENTS_SYSTEM_CONTEXT.md`

Eres un CLI agent (Copilot) trabajando bajo orquestaci√≥n de Claude Code Sonnet 4.5 (Orchestrator Maestro). Tu rol es ejecutar una auditor√≠a de Backend del microservicio ai-service de forma **100% aut√≥noma**.

---

# TAREA

Audita la calidad del backend del microservicio **ai-service**.

**M√≥dulo:** `/Users/pedro/Documents/odoo19/ai-service/`

**Enfoque:**
- Python code quality (PEP 8, type hints, docstrings)
- FastAPI patterns (async/await, dependency injection, middleware)
- Error handling (graceful degradation, circuit breakers, timeouts)
- Architecture (modular structure, separation of concerns, main.py size)
- Version consistency (README vs config.py)

**Target Score:** 90/100 (Excelente)

---

# PERMISOS (Pre-Autorizados - NO PEDIR CONFIRMACI√ìN)

Seg√∫n CLI_AGENTS_SYSTEM_CONTEXT.md, tienes **autonom√≠a total** para:

‚úÖ **Lectura:**
- Full access a TODO el proyecto: `/Users/pedro/Documents/odoo19/**`
- Leer cualquier archivo Python, YAML, JSON, MD, requirements.txt
- Ejecutar comandos an√°lisis: `grep`, `find`, `wc`, `tree`, `cat`, `head`, `tail`

‚úÖ **Escritura:**
- Escribir reporte en: `docs/prompts/06_outputs/2025-11/AUDIT_BACKEND_AI_SERVICE_V2_2025-11-13.md`
- Crear archivos temporales si es necesario

‚úÖ **An√°lisis:**
- Revisar estructura de archivos
- Contar l√≠neas de c√≥digo
- Analizar imports y dependencies
- Verificar type hints coverage

‚ùå **NO Hacer:**
- Modificar c√≥digo fuente (solo auditar, no modificar)
- Crear nuevos m√≥dulos
- Borrar archivos

**IMPORTANTE:** NO pidas confirmaci√≥n para reads/an√°lisis/writes en rutas autorizadas. Ejecuta la tarea de forma completamente aut√≥noma.

---

# OUTPUT

**Archivo de Reporte:**
`/Users/pedro/Documents/odoo19/docs/prompts/06_outputs/2025-11/AUDIT_BACKEND_AI_SERVICE_V2_2025-11-13.md`

**Formato del Reporte:**

```markdown
# Auditor√≠a Backend - AI Service Microservice

**Score:** X/100
**Fecha:** 2025-11-13
**Auditor:** Copilot CLI (GPT-4o)
**M√≥dulo:** ai-service
**Dimensi√≥n:** Backend (Python Quality + FastAPI Patterns)

---

## üìä Resumen Ejecutivo

[P√°rrafo de 3-4 l√≠neas con overview del estado del backend]

### Hallazgos Cr√≠ticos (Top 3):
1. **[P1/P2/P3]** Descripci√≥n finding 1 (archivo:l√≠nea)
2. **[P1/P2/P3]** Descripci√≥n finding 2 (archivo:l√≠nea)
3. **[P1/P2/P3]** Descripci√≥n finding 3 (archivo:l√≠nea)

---

## üéØ Score Breakdown

| Categor√≠a | Score | Detalles |
|-----------|-------|----------|
| **Python Code Quality** | X/25 | PEP 8, type hints, docstrings |
| **FastAPI Patterns** | X/25 | async/await, dependency injection |
| **Error Handling** | X/25 | Graceful degradation, circuit breakers |
| **Architecture** | X/25 | Modular structure, main.py size |
| **TOTAL** | **X/100** | Grade: A/B/C/D |

---

## üîç Hallazgos Detallados

### Backend-1: [T√≠tulo] (P1/P2/P3 - High/Medium/Low)
**Descripci√≥n:** [Qu√© encontraste]

**Ubicaci√≥n:** `archivo.py:l√≠nea`

**C√≥digo Actual:**
```python
# Ejemplo del problema
```

**Recomendaci√≥n:**
```python
# Soluci√≥n sugerida
```

**Esfuerzo:** X horas

---

[... Repetir para todos los hallazgos ...]

---

## ‚úÖ Fortalezas Identificadas

- ‚úÖ Fortaleza 1
- ‚úÖ Fortaleza 2
- ‚úÖ Fortaleza 3

---

## üöÄ Plan de Acci√≥n Prioritario

### Prioridad P1 (Alta - X hallazgos)
[Lista de hallazgos P1 con esfuerzo total estimado]

### Prioridad P2 (Media - X hallazgos)
[Lista de hallazgos P2 con esfuerzo total estimado]

### Prioridad P3 (Baja - X hallazgos)
[Lista de hallazgos P3 con esfuerzo total estimado]

---

**CONCLUSI√ìN:** [Resumen de 2-3 l√≠neas con score, principales gaps, y esfuerzo estimado para alcanzar 90/100]
```

**Stdout (Retornar al Finalizar):**

Cuando completes la auditor√≠a, retorna SOLO este resumen breve (<300 tokens):

```
‚úÖ Auditor√≠a Backend completada
Score: X/100 (Grade: A/B/C)
Gap to 90: -X puntos

Top 3 Findings:
[P1] Finding 1 brief (archivo:l√≠nea)
[P2] Finding 2 brief (archivo:l√≠nea)
[P3] Finding 3 brief (archivo:l√≠nea)

Esfuerzo P1+P2: ~X horas
Reporte completo: docs/prompts/06_outputs/2025-11/AUDIT_BACKEND_AI_SERVICE_V2_2025-11-13.md
```

---

# RESTRICCIONES

- ‚ùå NO modificar c√≥digo (solo auditar)
- ‚ùå NO crear nuevos m√≥dulos
- ‚è±Ô∏è  Target: < 5 minutos ejecuci√≥n
- üìä Enfoque: Calidad sobre velocidad

---

# NOTAS ADICIONALES

**Orquestaci√≥n v1.1 LEAN:**
Claude Code (Orchestrator) usa estrategia "Fire and Forget + File Polling":
1. Te lanza en background con este prompt
2. NO lee tus logs (usa file polling)
3. Espera que escribas el reporte en el archivo especificado
4. Lee SOLO las primeras 50 l√≠neas del reporte (summary)
5. Contin√∫a orquestaci√≥n

Por lo tanto:
- Escribe TODO en el archivo de reporte (no en stdout)
- Retorna resumen breve al finalizar
- Aseg√∫rate que las primeras 50 l√≠neas del reporte contengan: Score + Top 3 findings + Resumen ejecutivo

---

**Archivos Clave a Revisar:**
- `ai-service/main.py` (archivo principal)
- `ai-service/config.py` (settings)
- `ai-service/clients/` (Anthropic client)
- `ai-service/chat/` (engine, context manager)
- `ai-service/plugins/` (multi-module)
- `ai-service/utils/` (helpers)
- `ai-service/requirements.txt` (dependencies)

**M√©tricas Esperadas:**
- main.py: < 1,000 l√≠neas (actual: ~2,015 seg√∫n audit anterior)
- Type hints coverage: > 95%
- Docstrings coverage: > 90%
- FastAPI async patterns: 100% endpoints
- Version consistency: README == config.py

---

¬°Adelante! Ejecuta la auditor√≠a de forma completamente aut√≥noma.
