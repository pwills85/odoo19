{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Prompts System Metrics Dashboard",
  "description": "Schema for prompts execution metrics and quality tracking - Odoo 19 EERGYGROUP",
  "version": "1.0.0",
  "type": "object",
  "required": ["meta", "summary", "prompts", "agents", "compliance"],
  "properties": {
    "meta": {
      "type": "object",
      "description": "Metadata del dashboard",
      "required": ["generated_at", "version", "period"],
      "properties": {
        "generated_at": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp generación dashboard (ISO 8601)"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Versión sistema prompts (semver)"
        },
        "period": {
          "type": "object",
          "properties": {
            "start": {"type": "string", "format": "date"},
            "end": {"type": "string", "format": "date"}
          }
        }
      }
    },
    "summary": {
      "type": "object",
      "description": "Resumen ejecutivo métricas",
      "required": ["total_prompts", "total_executions", "avg_quality_score", "total_findings"],
      "properties": {
        "total_prompts": {
          "type": "integer",
          "description": "Prompts totales en sistema",
          "minimum": 0
        },
        "total_executions": {
          "type": "integer",
          "description": "Ejecuciones totales realizadas",
          "minimum": 0
        },
        "avg_quality_score": {
          "type": "number",
          "description": "Score promedio calidad prompts (0-100)",
          "minimum": 0,
          "maximum": 100
        },
        "total_findings": {
          "type": "integer",
          "description": "Hallazgos totales reportados",
          "minimum": 0
        },
        "total_effort_hours": {
          "type": "number",
          "description": "Esfuerzo total cierre (horas)",
          "minimum": 0
        },
        "templates_usage": {
          "type": "object",
          "description": "Uso de templates",
          "additionalProperties": {"type": "integer"}
        }
      }
    },
    "prompts": {
      "type": "array",
      "description": "Registro detallado de prompts",
      "items": {
        "type": "object",
        "required": ["id", "name", "template", "created", "status"],
        "properties": {
          "id": {
            "type": "string",
            "description": "ID único prompt (formato: PRM-YYYYMMDD-NNN)"
          },
          "name": {
            "type": "string",
            "description": "Nombre descriptivo prompt"
          },
          "template": {
            "type": "string",
            "enum": [
              "TEMPLATE_AUDITORIA",
              "TEMPLATE_CIERRE_BRECHA",
              "TEMPLATE_P4_DEEP_ANALYSIS",
              "TEMPLATE_P4_INFRASTRUCTURE_AUDIT",
              "TEMPLATE_MULTI_AGENT_ORCHESTRATION",
              "CUSTOM"
            ]
          },
          "module": {
            "type": "string",
            "description": "Módulo Odoo target"
          },
          "priority": {
            "type": "string",
            "enum": ["P0", "P1", "P2"]
          },
          "created": {
            "type": "string",
            "format": "date-time"
          },
          "executed": {
            "type": "boolean",
            "description": "Si fue ejecutado o es draft"
          },
          "execution_date": {
            "type": "string",
            "format": "date-time"
          },
          "agent": {
            "type": "string",
            "description": "Agente que ejecutó (Claude Code, Copilot CLI, etc.)"
          },
          "duration_hours": {
            "type": "number",
            "description": "Duración ejecución (horas)",
            "minimum": 0
          },
          "quality_score": {
            "type": "number",
            "description": "Score calidad prompt (validación automática 0-100)",
            "minimum": 0,
            "maximum": 100
          },
          "status": {
            "type": "string",
            "enum": ["draft", "validated", "executed", "completed", "archived"]
          },
          "findings": {
            "type": "object",
            "properties": {
              "total": {"type": "integer", "minimum": 0},
              "p0": {"type": "integer", "minimum": 0},
              "p1": {"type": "integer", "minimum": 0},
              "p2": {"type": "integer", "minimum": 0}
            }
          },
          "output_file": {
            "type": "string",
            "description": "Ruta archivo output generado"
          },
          "tags": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Tags categorización (compliance, security, performance, etc.)"
          }
        }
      }
    },
    "agents": {
      "type": "array",
      "description": "Performance por agente (Claude, Copilot, etc.)",
      "items": {
        "type": "object",
        "required": ["name", "executions", "avg_duration", "avg_quality"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Nombre agente"
          },
          "executions": {
            "type": "integer",
            "description": "Ejecuciones totales",
            "minimum": 0
          },
          "avg_duration": {
            "type": "number",
            "description": "Duración promedio (horas)",
            "minimum": 0
          },
          "avg_quality": {
            "type": "number",
            "description": "Calidad promedio outputs (0-100)",
            "minimum": 0,
            "maximum": 100
          },
          "total_findings": {
            "type": "integer",
            "minimum": 0
          },
          "specialization": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Áreas especialización (compliance, backend, infra, etc.)"
          }
        }
      }
    },
    "compliance": {
      "type": "object",
      "description": "Métricas compliance Odoo 19 CE",
      "required": ["deprecations", "closure_progress"],
      "properties": {
        "deprecations": {
          "type": "object",
          "description": "Deprecaciones detectadas",
          "properties": {
            "p0": {
              "type": "object",
              "properties": {
                "total": {"type": "integer"},
                "closed": {"type": "integer"},
                "pending": {"type": "integer"},
                "closure_rate": {"type": "number", "minimum": 0, "maximum": 100}
              }
            },
            "p1": {
              "type": "object",
              "properties": {
                "total": {"type": "integer"},
                "closed": {"type": "integer"},
                "pending": {"type": "integer"},
                "closure_rate": {"type": "number", "minimum": 0, "maximum": 100}
              }
            },
            "p2": {
              "type": "object",
              "properties": {
                "total": {"type": "integer"},
                "closed": {"type": "integer"},
                "pending": {"type": "integer"},
                "closure_rate": {"type": "number", "minimum": 0, "maximum": 100}
              }
            }
          }
        },
        "closure_progress": {
          "type": "object",
          "description": "Progreso cierres por módulo",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "total_findings": {"type": "integer"},
              "closed": {"type": "integer"},
              "pending": {"type": "integer"},
              "closure_rate": {"type": "number"},
              "effort_spent_hours": {"type": "number"},
              "effort_remaining_hours": {"type": "number"}
            }
          }
        },
        "quality_metrics": {
          "type": "object",
          "properties": {
            "test_coverage_avg": {"type": "number", "minimum": 0, "maximum": 100},
            "complexity_avg": {"type": "number"},
            "security_score": {"type": "number", "minimum": 0, "maximum": 100}
          }
        }
      }
    },
    "trends": {
      "type": "object",
      "description": "Tendencias temporales",
      "properties": {
        "weekly": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "week": {"type": "string", "pattern": "^\\d{4}-W\\d{2}$"},
              "executions": {"type": "integer"},
              "findings": {"type": "integer"},
              "closures": {"type": "integer"}
            }
          }
        },
        "monthly": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "month": {"type": "string", "pattern": "^\\d{4}-\\d{2}$"},
              "executions": {"type": "integer"},
              "findings": {"type": "integer"},
              "closures": {"type": "integer"}
            }
          }
        }
      }
    },
    "cost_analysis": {
      "type": "object",
      "description": "Análisis costos (tokens, tiempo)",
      "properties": {
        "total_tokens_used": {
          "type": "integer",
          "description": "Tokens totales consumidos",
          "minimum": 0
        },
        "total_cost_usd": {
          "type": "number",
          "description": "Costo total estimado (USD)",
          "minimum": 0
        },
        "avg_tokens_per_prompt": {
          "type": "integer",
          "minimum": 0
        },
        "cost_per_finding": {
          "type": "number",
          "description": "Costo promedio por hallazgo (USD)",
          "minimum": 0
        },
        "roi_metrics": {
          "type": "object",
          "properties": {
            "manual_hours_saved": {"type": "number"},
            "automation_value_usd": {"type": "number"}
          }
        }
      }
    }
  }
}
